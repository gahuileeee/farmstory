<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/admin/layout/adminLayout.html}">
<main layout:fragment="content">
    <script>
        function saveGrade(selectElement) {
            var selectedGrade = selectElement.value;
            var uid = selectElement.dataset.uid;
            console.log("UserID :" + uid+ ",grade : " +selectedGrade);

            const jsonData = {
                "uid" : uid,
                "grade" : selectedGrade
            }
            console.log(jsonData);

            const data = fetchPut(`/farmstory/admin/user/modifyGrade`, jsonData);
            console.log(data);

            alert("수정이 완료되었습니다.");

        }
    </script>
    <aside>
        <h3>주요기능</h3>
        <ul>
            <li>
                <span>상품관리</span>
                <ol>
                    <li><a th:href="@{/admin/product/list}">상품목록</a></li>
                    <li><a th:href="@{/admin/product/register}">상품등록</a></li>
                </ol>
            </li>
            <li>
                <span>주문관리</span>
                <ol>
                    <li><a th:href="@{/admin/order/list}">주문목록</a></li>
                    <li><a th:href="@{/admin/order/delivery}">배송관리</a></li>
                </ol>
            </li>
            <li>
                <span>회원관리</span>
                <ol>
                    <li><a th:href="@{/admin/user/list}">회원목록</a></li>
                    <li><a th:href="@{/admin/user/register}">회원등록</a></li>
                </ol>
            </li>
        </ul>
    </aside>
        <section id="orderList">
            <nav>
                <h3>회원목록</h3>
            </nav>

            <article>

                <table border="0">
                    <tr>
                        <th><input type="checkbox" name="all"/></th>
                        <th>아이디</th>
                        <th>이름</th>
                        <th>별명</th>
                        <th>이메일</th>
                        <th>휴대폰</th>
                        <th>등급</th>
                        <th>가입일</th>
                        <th>확인</th>
                    </tr>
                    <tr th:each="users, index:${userPageResponseDTO.dtoList}" id="user">
                        <td><input type="checkbox" name="selectedUser"/></td>
                        <td>[[${users.uid}]]</td>
                        <td>[[${users.name}]]</td>
                        <td>[[${users.nick}]]</td>
                        <td>[[${users.email}]]</td>
                        <td>[[${users.hp}]]</td>
                        <td>
                            <select name="grade" onchange="saveGrade(this)" th:data-uid="${users.uid}">
                                <option th:selected="${users.getGrade() eq 'Bronze'}" value="Bronze">Bronze</option>
                                <option th:selected="${users.getGrade() eq 'Silver'}" value="Silver">Silver</option>
                                <option th:selected="${users.getGrade() eq 'Gold'}" value="Gold">Gold</option>
                                <option th:selected="${users.getGrade() eq 'Platinum'}" value="Platinum">Platinum</option>
                                <option th:selected="${users.getGrade() eq 'Diamond'}" value="Diamond">Diamond</option>
                            </select>
                        </td>
                        <td th:text="${#temporals.format(users.regDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
                        <td><a th:href="@{/admin/user/detail(uid=${users.uid})}">[상세확인]</a></td>
                    </tr>
                </table>

                <p class="paging">
                    <span th:if="${userPageResponseDTO.prev}" >
                        <a th:href="@{/admin/user/list(pg=${userPageResponseDTO.start - 1})}"><</a>
                    </span>
                    <span th:each="num:${#numbers.sequence(userPageResponseDTO.start, userPageResponseDTO.end)}">
                    <a th:if="${num != 0}" th:href="@{/admin/user/list(pg=${num})}" th:class="${num == 1} ? 'on' : ''">[ [[${num}]] ]</a>
                </span>
                    <span th:if="${userPageResponseDTO.next}">
                         <a th:href="@{/admin/user/list(pg=${userPageResponseDTO.end + 1})}">></a>
                    </span>
                </p>
            </article>
        </section>
</main>

</html>